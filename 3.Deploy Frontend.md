# Frontend:

Nếu server mạnh thì run npm trên server, còn không thì chỉ deploy file tĩnh

## Cai nodejs >= v20.0.0

```
sudo apt install -y nodejs
sudo apt install npm -y
node -v
npm -v
```

Nếu version < v20.0.0:

```
npm install -g n
n latest
hash -r
node -v
npm install -g npm
npm -v
```

## Build trực tiếp trên server

-   `scp -r frontend/.env root@159.223.90.44:/root/kt-speakup/frontend`
-   kiểm tra bằng `ls -a /root/kt-speakup/frontend`

```
cd kt-speakup/frontend
npm install
npm run build
mv dist /var/www/kt-speakup
```

## Build frontend tren may local

`npm run build`

```
cd kt-speakup/frontend
npm install
```

## nếu upload lại thì nên xóa đi rồi up lại và Cập nhật quyền để overwrite

`sudo rm -rf /var/www/kt-speakup/*`

Copy lên VPS (nếu build ở local):\
`scp -r dist/* root@your-vps-ip:/var/www/kt-speakup`\
`scp -r dist/* root@159.223.90.44:/var/www/kt-speakup`

## Cấp quyền để truy cập folder dist cho các user gọi từ web

```
sudo chown -R www-data:www-data /var/www/kt-speakup
sudo chmod -R 755 /var/www/kt-speakup
ls /var/www/kt-speakup
```

# 6. Cấu hình Nginx để đưa app ra cổng 80 (http)

### proxy_pass

`sudo nano /etc/nginx/sites-available/kt-speakup`

-   Dán nội dung:

```
server {
    listen 80;
    server_name speakup.ktstudio.vn;
    return 301 https://$host$request_uri;
}

server {
    listen 80;
    server_name speakup.ktstudio.vn;

    # Phục vụ file tĩnh từ frontend
    root /var/www/kt-speakup;

    # Phục vụ file trong /assets/ trực tiếp
    location /assets/ {
        try_files $uri =404;  # Trả về 404 nếu file không tồn tại
    }

    # Phục vụ SPA
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Proxy API tới backend
    location /api/ {
        proxy_pass http://127.0.0.1:8000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        client_max_body_size 10M;
    }
}

server {
    listen 80;
    server_name storage.speakup.ktstudio.vn;
    return 301 https://$host$request_uri;
}

server {
    listen 80;
    server_name storage.speakup.ktstudio.vn;

    location / {
        proxy_pass http://127.0.0.1:9000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_redirect off;
        client_max_body_size 100M;
    }
}

```

-   Kích hoạt config:

```
Tạo symbolic link để kích hoạt site
sudo ln -s /etc/nginx/sites-available/kt-speakup /etc/nginx/sites-enabled/

Kiểm tra cấu hình Nginx có hợp lệ không
sudo nginx -t

Khởi động lại Nginx
sudo systemctl restart nginx

```

# 7. Truy cập thử

`http://<vps-ip>`\
