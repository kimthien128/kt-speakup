# Backend:

# 1. Cài đặt các gói cần thiết trên VPS

-   mở CORS tới ip, domain của vpn (trong file backend/config/app_config.py)
-   tải Vosk, Piper hoặc tắt chúng trong biến môi trường
-   copy file google-credentials.json'
-   `scp -r backend/google-credentials.json root@159.223.90.44:/root/kt-speakup/backend`

**Yêu cầu python 3.12**

```
sudo apt update && sudo apt upgrade -y
sudo apt install python3 python3-pip python3-venv nginx -y

sudo add-apt-repository ppa:deadsnakes/ppa
sudo apt update
sudo apt install python3.12 python3.12-venv
python3.12 --version
```

# 2. Upload mã nguồn backend lên VPS

-   Cài git:\
    `sudo apt install git -y`
-   Clone:

```
tạo ssh nếu chưa có
ssh-keygen -t ed25519 -C "your_email@example.com"
cat ~/.ssh/id_ed25519.pub
dán nội dung vào GitHub: Settings → SSH and GPG keys → New SSH key
git clone git@github.com:kimthien128/kt-speakup.git
cd kt-speakup
```

**_Lưu ý: Copy file .env và sửa nội dung cần thiết_**

-   `scp -r backend/.env root@159.223.90.44:/root/kt-speakup/backend`
-   kiểm tra bằng `ls -a /root/kt-speakup/backend`

# 3. Tạo môi trường ảo Python và cài dependencies

-   đứng ở /kt-speakup

```
python3.12 -m venv venv
source venv/bin/activate
pip install --upgrade pip
pip install -r backend/requirements.txt
```

# 4. Chạy thử FastAPI

-   ubuntu:\
    `python3 -m backend.server`

# 5. Chạy FastAPI backend như một dịch vụ (service) trong Ubuntu

-   Tạo file:\
    `sudo nano /etc/systemd/system/ktspeakup.service`
-   Nội dung:

```
[Unit]
Description=FastAPI App
After=network.target

[Service]
User=root
Group=www-data
WorkingDirectory=/root/kt-speakup
ExecStart=/root/kt-speakup/venv/bin/python -m backend.server
Restart=always

[Install]
WantedBy=multi-user.target

```

-   Khởi động:

```
sudo systemctl daemon-reexec
sudo systemctl daemon-reload
sudo systemctl enable ktspeakup
sudo systemctl start ktspeakup

```

-   Xem log trưc tiep:\
    -   `sudo journalctl -u ktspeakup -f`
    -   `sudo systemctl restart ktspeakup`
